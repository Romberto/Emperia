#!/bin/bash
# –∑–∞–ø—É—Å–∫: ./push "—Ç–µ–∫—Å—Ç –∫–æ–º–º–∏—Ç–∞"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∞—Ä–≥—É–º–µ–Ω—Ç
if [ -z "$1" ]; then
  echo "‚ùå –£–∫–∞–∂–∏ —Ç–µ–∫—Å—Ç –∫–æ–º–º–∏—Ç–∞: ./push \"—Ç–µ–∫—Å—Ç –∫–æ–º–º–∏—Ç–∞\""
  exit 1
fi

COMMIT_MSG="$1"

echo "üé® –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∫–æ–¥ —Å black..."
black .

echo "üß™ –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã..."
cd fast_application || exit 1
pytest || { echo "‚ùå –¢–µ—Å—Ç—ã —É–ø–∞–ª–∏. –ö–æ–º–º–∏—Ç –∏ –ø—É—à –æ—Ç–º–µ–Ω–µ–Ω—ã."; exit 1; }
cd ..

echo "üì¶ –î–æ–±–∞–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è..."
git add .

echo "üìù –ö–æ–º–º–∏—Ç–∏–º: $COMMIT_MSG"
git commit -m "$COMMIT_MSG"

echo "üöÄ –ü—É—à–∏–º –≤ origin back-prod"
git push origin back-prod
